# 2장 테스트 환경 구성

1. virtual box, vagrant 설치
2. 먼저 프로비저닝을 위한 코드를 작성(해당 예시에서는 설치 폴더로 이동해 기본 코드 생성)

** 프로비저닝(**Provisioning)** : 사용자의 요구에 맞게 시스템 자원을 할당, 배치, 배포해 두었다가 필요 시 시스템을 즉시 사용할 수 있는 상태로 미리 준비해 두는 것

1. 프로비저닝을 위한 기초 파일 생성

```bash
C:\HashiCorp>vagrant init
A `Vagrantfile` has been placed in this directory. You are now
ready to `vagrant up` your first virtual environment! Please read
the comments in the Vagrantfile as well as documentation on
`vagrantup.com` for more information on using Vagrant.
```

1. 생성된 파일에 [config.vm.box](http://config.vm.box) = “base” 내용 확인
    
    설치 이미지가 base로 명시돼 있음 → 베이그런트 클라우드에서 가상 이미지 사용
    
    [https://app.vagrantup.com/boxes/search](https://app.vagrantup.com/boxes/search)
    
2. Vagrantfile을 읽어 프로비저닝 진행 - 가상머신 이미지 다운

```bash
C:\HashiCorp>vagrant up
Bringing machine 'default' up with 'virtualbox' provider...
==> default: Importing base box 'sysnet4admin/CentOS-k8s'...
==> default: Matching MAC address for NAT networking...
==> default: Checking if box 'sysnet4admin/CentOS-k8s' version '0.7.4' is up to date...
==> default: Setting the name of the VM: HashiCorp_default_1645403858372_64860
==> default: Fixed port collision for 22 => 2222. Now on port 2200.
==> default: Clearing any previously set network interfaces...
==> default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
==> default: Forwarding ports...
    default: 22 (guest) => 2200 (host) (adapter 1)
==> default: Booting VM...
==> default: Waiting for machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2200
    default: SSH username: vagrant
    default: SSH auth method: private key
    default:
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair for better security.
    default:
    default: Inserting generated public key within guest...
    default: Removing insecure key from the guest if it's present...
    default: Key inserted! Disconnecting and reconnecting using new SSH key...
==> default: Machine booted and ready!
==> default: Checking for guest additions in VM...
    default: The guest additions on this VM do not match the installed version of
    default: VirtualBox! In most cases this is fine, but in rare cases it can
    default: prevent things such as shared folders from working properly. If you see
    default: shared folder errors, please make sure the guest additions within the
    default: virtual machine match the version of VirtualBox you have installed on
    default: your host and reload your VM.
    default:
    default: Guest Additions Version: 5.2.12
    default: VirtualBox Version: 6.1
==> default: Mounting shared folders...
    default: /vagrant => C:/HashiCorp
Vagrant was unable to mount VirtualBox shared folders. This is usually
because the filesystem "vboxsf" is not available. This filesystem is
made available via the VirtualBox Guest Additions and kernel module.
Please verify that these guest additions are properly installed in the
guest. This is not a bug in Vagrant and is usually caused by a faulty
Vagrant box. For context, the command attempted was:

mount -t vboxsf -o uid=1000,gid=1000,_netdev vagrant /vagrant

The error output from the command was:

mount: unknown filesystem type 'vboxsf' 
-> 마지막 에러는 버추얼 박스 게스트 에디션이 설치되지 않아서 발생(진행과는 무관)

```

1. 버추얼박스에 가상머신 생성된 것 확인
2. 설치된 CentOS에 접속

```bash
C:\HashiCorp>vagrant ssh
[vagrant@k8s ~]$
```

1. 설치 정상인지 실행 시간(uptime)과 운영 체제 종류 확인

```bash
[vagrant@k8s ~]$ uptime
 09:41:28 up 3 min,  1 user,  load average: 0.02, 0.08, 0.05
[vagrant@k8s ~]$ cat /etc/redhat-release
CentOS Linux release 7.8.2003 (Core)
```

1. exit으로 가상 머신 빠져나오고 테스트용이므로 삭제
    
    -f 는 가상머신 강제 종료 옵션

```bash
C:\HashiCorp>vagrant destroy -f
==> default: Forcing shutdown of VM...
==> default: Destroying VM and associated drives...
```