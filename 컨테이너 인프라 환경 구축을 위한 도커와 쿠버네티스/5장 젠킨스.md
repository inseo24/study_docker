### 4장까지 진행 과정 정리

1. 깃헙 등 저장소에 올린 어플리케이션 소스 코드를 내려받아 도커 컨테이너 이미지로 빌드(docker build)
2. 빌드한 컨테이너 이미지를 쿠버네티스에서 사용할 수 있도록 레지스트리에 등록(docker push)
3. 레지스트리에 등록된 이미지를 기반으로 쿠버네티스 오브젝트를 생성(kubectl create)
4. 생성한 오브젝트(pod/deployement)를 외부에서 접속할 수 있도록 서비스 형태로 노출(kubectl expose)

이런 과정을 파이프 라인이라고 한다.

이를 도구를 통해 자동화할 수 있다.

자동화는 크게 지속적 통합(CI, Continuous Integration), 지속적 배포(CD, Continuous Deployment) 두 가지로 정의되고, 일반적으로 둘을 합쳐 CI/CD라고 한다.

### 컨테이너 인프라 환경에서 CI/CD

CI은 일반적으로 코드를 커밋하고 빌드했을 때 정상적으로 작동하는지 반복적으로 컴증해 애플리케이션의 신뢰성을 높이는 작업이다. CI 과정을 마친 애플리케이션은 신뢰할 수 있는 상태가 된다. 

CD는 CI 과정에서 생성된 신뢰성 있는 애플리케이션을 실제 사용 환경에 자동으로 배포하는 것을 의미한다. 배포할 때 고려할 사항이 여러 가지 있는데, 이를 CD에 미리 정의하면 실수를 줄이고, 실제 적용 시간도 최소화할 수 있다.

개발자가 소스를 커밋하고 푸시하면 CI 단계로 들어간다. CI 단계에서는 애플리케이션이 자동 빌드되고 테스트를 거쳐 배포할 수 있는 애플리케이션인지 확인한다. 테스트를 통과하면 신뢰할 수 있는 애플리케이션으로 간주하고 CD 단계로 넘어간다. CD 단계에서는 애플리케이션을 컨테이너 이미지로 만들어서 파드, 디플로이먼트, 스테이트풀셋 등 다양한 오브젝트 조건에 맞춰 미리 설정한 파일을 통해 배포한다.

**CI/CD 도구**

| 구분 | 팀시티 | 깃허브 액션 | 뱀부 | 젠킨스 |
| --- | --- | --- | --- | --- |
| 설치 방식 | 직접 설치 | 깃허브 연동 | 직접 설치 | 직접 설치 |
| 연계 기능 | 보통 | 보통 | 부족 | 매우 많음 |
| 가격 | 무료/유료 | 무료/유료 | 유료 | 무료 |
| 기능 추가 | 보통 | 매우 다양 | 보통 | 매우 다양 |
| 범용성 | 보통 | 매우 큼 | 보통 | 매우 큼 |
| 정보량 | 부족 | 많음 | 많음 | 매우 많음 |

이외에 클라우드 서비스에서 제공하는 AWS CodeBuilde, CodePipeline, CodeDeploy, GCP CloudBuild, Azure Pipeline 등이 있다. 배포가 중요한 환경이라면 CD 기능이 중점인 Spinnaker나 아르고 CD(Argo CD)를 선택적으로 도입할 수도 있다.

개발자가 작성한 애플리케이션 코드를 소스 코드 저장소에 푸시하면 쿠버네티스 내부에 설치된 젠킨스는 앱 코드를 빌드하고 레지스트리에 푸시한 후 쿠버네티스에서 사용 가능한 형태로 배포한다. 젠킨스는 작업 내용을 아이템 단위로 정의하고 조건에 따라 자동으로 작업을 수행해 효율을 높이고 실수를 줄인다.

컨테이너 인프라 환경에서 젠킨스를 사용하는 주된 이유는 애플리케이션을 컨테이너로 만들고 배포하는 과정을 자동화하기 위함이다. 젠킨스는 컨트롤러와 에이전트 형태를 구성한 다음 배포해야 하며 여기에 필요한 설정을 모두 넣어야 한다. 동적인 변경 사항을 간편하고 빠르게 적용할 수 있도록 도와주는 도구가 2가지가 있다. 하나는 커스터마이즈고 다른 하나는 헬름이다. 

### 배포 간편화 도구 비교하기

| 구분 | kubectl | kustomize | Helm |
| --- | --- | --- | --- |
| 설치 방법 | 쿠버네티스 기본 포함 | 별도 실행 파일 또는 쿠버네티스에 통합 | 별도 설치 |
| 배포 대상 | 정적 yaml 파일 | 커스터마이즈 파일 | 패키지(차트) |
| 주 용도 | 오브젝트 관리 및 배포 | 오브젝트의 가변적 배포 | 패키지 단위 오브젝트 배포 및 관리 |
| 가변적 환경 | 대응 힘듦(yaml 수정 필요) | 간단한 대응 가능 | 복잡한 대응 가능 |
| 기능 복잡도 | 단순 | 보통 | 복잡함 |